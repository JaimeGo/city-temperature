let WebSocketServer,http,getCityInfo,getCoordinates;_f37‍.w("ws",[["default",["WebSocketServer"],function(v){WebSocketServer=v}]]);_f37‍.w("http",[["default",["http"],function(v){http=v}]]);_f37‍.w("./api/index.js",[["getCityInfo",["getCityInfo"],function(v){getCityInfo=v}]]);_f37‍.w("./redis/index.js",[["getCoordinates",["getCoordinates"],function(v){getCoordinates=v}]]);




const server = http.createServer();

const wss = new WebSocketServer.Server({ server: server });

console.log('Websocket server created');

const namesOfCities = [
	'Santiago (CL)',
	'Zurich (CH)',
	'Auckland (NZ)',
	'Sydney (AU)',
	'London (UK)',
	'Georgia (USA)'
];

wss.on('connection', function(ws) {
	const intervalId = setInterval(function() {
		const apiResults = namesOfCities.map(async cityName => {
			const { latitude, longitude } = await getCoordinates(cityName);

			return await getCityInfo(cityName, latitude, longitude);
		});
		ws.send(apiResults);
	}, 10000);

	console.log('Websocket connection opened');

	ws.on('close', function() {
		console.log('Websocket connection closed');
		clearInterval(intervalId);
	});
});

const port = process.env.PORT || 5000;

server.listen(port);

_f37‍.g.console.log('Http server listening on %d', port);
